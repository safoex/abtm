common:
  root_child: main
  parameters:
    online: 1

functions:
  cpp:
    helloworld:
      name: helloworld

    hellosber:
      name: hellosber
      remap:
        times: times1

    icub_move:
      name: iCub_move

variables:
  input: ["RUNNING", "SUCCESS", "FAILED", "UNDEFINED", a,b,c,d, A00]
  output_no_send_zero: [yy,zz]
  output: [aa,bb,cc,dd]

set:
  A00: 0
  RUNNING: 0
  SUCCESS: 1
  FAILED: 2
  UNDEFINED: 3
  a: 0
  b: 0
  c: 0
  d: 0
  yy: 0
  zz: 0
  aa: 0
  bb : 0
  cc: 0
  dd: 0

templates:
  latch:
    args:
      required: [child]

    var:
      __STATE__$child: [input, UNDEFINED]

    nodes:
      $name:
        type: skipper
        children: [~mask, $child]

      ~mask:
        type: condition
        S: __STATE__$child == SUCCESS
        F: __STATE__$child == FAILED
        R: default

    children: [$child]

  reset:
    args:
      required: [child]

    var:
      __STATE__$child: [input, UNDEFINED]

    nodes:
      $name:
        type: action
        assign:
          __STATE__$child: UNDEFINED

  seq_latches:
    args:
      required: [children]
      construct:
        _children_latched:
          from: children
          V: $V_latch
      view_exclude: [children]

    nodes:
      $name:
        type: sequence
        children: $_children_latched

    unpack:
      children:
        nodes:
          $V_latch:
            type: t/latch
            child: $V

    children: $children

  control:
    args:
      required: [children, _type]
      view_exclude: [children]

    nodes:
      $name:
        type: $_type
        children: $children

    children: $children

  action_return:
    args:
      required: [assign]
      optional:
        return: S
      view_exclude: [assign]

    nodes:
      $name:
        type: sequence
        children: [~act, ~cond]
      ~act:
        type: action
        assign: $assign
      ~cond:
        type: condition
        $return: default

    children: [~act]



nodes:
  main:
    type: sequence
    children: [S0]
#    children: [E, L, C1, LL, C2, S0]
#
#  E:
#    type: condition
#    S: z > 0
#    R: default
#    var:
#      z: [input, 0]
#
#  L:
#    type: t/latch
#    child: T
#
#  T:
#    type: sequence
#    children: [count, cond]
#
#  count:
#    type: action
#    assign:
#      x: x + 1
#    var:
#      x: [output, 0]
#
#  cond:
#    type: condition
#    S: y > 0
#    R: default
#    var:
#      y: [input, 0]
#
#  C1:
#    type: condition
#    S: v > 1
#    R: default
#    var:
#      v: [input, 0]
#
#  LL:
#    type: t/latch
#    child: RLS
#
#  RLS:
#    type: sequence
#    children: [RL, A]
#
#  RL:
#    type: t/reset
#    child: T
#
#  A:
#    type: action
#    assign:
#      z: 0
#
#  C2:
#    type: condition
#    S: z > 2
#    R: default

  S0:
    type: t/seq_latches
    children:
      - A01
      - A02
      - A03

  A01:
    type: t/action_return
    return: F
    assign:
      A00: 0

  A02:
    type: action
    assign:
      A01: 0
    var:
      A01: [input, 0]

  A03:
    type: action
    assign:
      A02: 0
    var:
      A02: [input, 0]






